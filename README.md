# 247 Sports Recruiting Ranking Scraper
This project is a set of Python scripts to fetch and process publicly available data from 247 for non-commercial, personal data analysis use. I have no intention of supporting this project long-term, so if any of the HTML changes on the site, the scraper will need to be modified.

## Stage 1: Fetching Recruit Lists by Year
Players are scraped from the recruiting index page in the following format:
```json
{
  "247_id": "46038819",
  "247_url": "https://247sports.com/Player/Bryan-Bresee-46038819",
  "full_name": "Bryan Bresee",
  "year": 2020,
  "position": "DT",
  "high_school": "Damascus",
  "city": "Damascus",
  "state": "MD",
  "score": "0.9995",
  "stars": 5,
  "height_feet": 6.0,
  "height_inches": 5.0,
  "weight": 290.0
}
``` 
There's also some basic exception handling to insert default values for inconsistent or missing data.
![Error handling](screenshots/recruit-list-error-handling.png)

Before running the script, be sure to change the year range to fetch for:
```python
year_range = range(2010, 2021)
```

All dependencies are located in `requirements.txt`. To run, simple execute the command `python scrape_recruit_list.py`. The script will generate a file for each year (i.e. `recruit-list-2020.json`) in the `/recruit-lists` directory. These files are ignored by Git.

## Stage 2: Obtaining Ranking History and Recruiting Timeline Events
With a set of lists generated by Stage 1, the `process_recruits.py` script fetches and parses the complete ranking history and events (i.e. official visits, offers, etc.). To run, pass a recruiting list from Stage 1 and the corresponding year to produce the files: `python process_recruits.py 2020 recruit-lists/recruit-list-2020.json`.

247's data isn't perfectly formatted, so Stage 3 fixes issues from Stage 2 and formats for more efficient querying using AWS Athena.
![Error handling](screenshots/process-recruits-error-handling.png)

Recruit ranking histories are stored in the following path: `/recruit-ranking-histories/{year}/{247_id}.json`. For example, Bryan Bresee's path would be `/recruit-ranking-histories/2020/46038819.json` in the following format:
```json
{"247_id": "46038819", "rating": 0.9995, "rank": 1.0, "change_date": "2020-01-31", "delta": -0.0002, "delta_inception_value": 0.0295}
{"247_id": "46038819", "rating": 0.9997, "rank": 1.0, "change_date": "2019-12-15", "delta": 0.0001, "delta_inception_value": 0.0297}
{"247_id": "46038819", "rating": 0.9996, "rank": 1.0, "change_date": "2019-10-15", "delta": 0.0002, "delta_inception_value": 0.0296}
{"247_id": "46038819", "rating": 0.9993, "rank": 1.0, "change_date": "2019-08-15", "delta": 0.0003, "delta_inception_value": 0.0293}
{"247_id": "46038819", "rating": 0.9991, "rank": 2.0, "change_date": "2019-07-31", "delta": 0.0002, "delta_inception_value": 0.0291}
{"247_id": "46038819", "rating": 0.9988, "rank": 2.0, "change_date": "2019-06-15", "delta": 0.0003, "delta_inception_value": 0.0288}
{"247_id": "46038819", "rating": 0.9986, "rank": 2.0, "change_date": "2019-04-30", "delta": -0.0004, "delta_inception_value": 0.0286}
{"247_id": "46038819", "rating": 0.999, "rank": 1.0, "change_date": "2019-02-28", "delta": -0.0001, "delta_inception_value": 0.029}
{"247_id": "46038819", "rating": 0.9992, "rank": 2.0, "change_date": "2019-02-15", "delta": -0.0003, "delta_inception_value": 0.0292}
{"247_id": "46038819", "rating": 0.9995, "rank": 1.0, "change_date": "2018-12-15", "delta": -0.0001, "delta_inception_value": 0.0295}
{"247_id": "46038819", "rating": 0.9996, "rank": 1.0, "change_date": "2018-08-31", "delta": -0.0001, "delta_inception_value": 0.0296}
{"247_id": "46038819", "rating": 0.9998, "rank": 1.0, "change_date": "2018-07-31", "delta": 0.0001, "delta_inception_value": 0.0298}
{"247_id": "46038819", "rating": 0.9996, "rank": 1.0, "change_date": "2018-06-26", "delta": -0.0004, "delta_inception_value": 0.0296}
{"247_id": "46038819", "rating": 1.0, "rank": 1.0, "change_date": "2017-11-30", "delta": 0.03, "delta_inception_value": 0.03}
{"247_id": "46038819", "rating": 0.97, "rank": 0.0, "change_date": "2015-08-10", "delta": 0.0, "delta_inception_value": 0.0}
```

Recruiting timeline events are stored in the following path: `/recruit-timeline-histories/{year}/{247_id}.json`. For example, Bryan Bresee's path would be `/recruit-timeline-histories/2020/46038819.json` in the following format:
```json
{"247_id": "46038819", "event_date": "2020-01-08", "event_type": "Enrollment", "event_description": "Bryan Bresee enrolls at Clemson Tigers"}
{"247_id": "46038819", "event_date": "2019-12-18", "event_type": "Signing", "event_description": "Bryan Bresee signs letter of intent to Clemson Tigers"}
{"247_id": "46038819", "event_date": "2019-12-13", "event_type": "Official Visit", "event_description": "Bryan Bresee officially visits Clemson Tigers"}
{"247_id": "46038819", "event_date": "2019-11-16", "event_type": "Official Visit", "event_description": "Bryan Bresee officially visits Clemson Tigers"}
{"247_id": "46038819", "event_date": "2019-04-23", "event_type": "Commitment", "event_description": "Bryan Bresee commits to Clemson Tigers"}
{"247_id": "46038819", "event_date": "2019-04-06", "event_type": "Unofficial Visit", "event_description": "Bryan Bresee unofficially visits Clemson Tigers"}
{"247_id": "46038819", "event_date": "2019-02-28", "event_type": "Offer", "event_description": "Georgia Tech Yellow Jackets offer Bryan Bresee"}
{"247_id": "46038819", "event_date": "2019-02-15", "event_type": "Unofficial Visit", "event_description": "Bryan Bresee unofficially visits Georgia Bulldogs"}
{"247_id": "46038819", "event_date": "2019-02-05", "event_type": "Offer", "event_description": "Miami Hurricanes offer Bryan Bresee"}
{"247_id": "46038819", "event_date": "2019-01-26", "event_type": "Unofficial Visit", "event_description": "Bryan Bresee unofficially visits Clemson Tigers"}
```

Given the large amount of data to process during Stage 2, this project also includes a bootstrapping script for EC2 instances to install the Python tooling, configure the virtual environment, and pull the data from Stage 1 via S3:

```shell script
#!/bin/bash
sudo yum install git -y
sudo yum install python3 -y
git clone https://github.com/scottenriquez/247-recruiting-ranking-history-scraper.git
cd 247-recruiting-ranking-history-scraper
mkdir recruit-lists
mkdir recruit-ranking-histories
mkdir recruit-timeline-histories
aws s3 cp s3://247-recruit-rankings-2010-2020/recruit-list/ recruit-lists --recursive
python3 -m venv env
source env/bin/activate
sudo pip3 install -r requirements.txt
sudo python3 process_recruits.py 2020 ./recruit-lists/recruit-list-2020.json
```

Note that since S3 bucket names are globally unique, this will need to be changed for any other bucket.

## Stage 3: Cleanup and Optimization
The default output of the application should create 3 directories containing many different files. This format should be usable by a wide variety of tools, and it should make it easier to grab only a subset of the data if needed. 
- `/recruit-lists` will contain one file per year containing all recruits from that year
- `/recruit-ranking-histories` will contain subdirectories of each year, each holding an individual json file per recruit which holds all their ranking
- `/recruit-timeline-histories` will contain subdirectores of each yet, each holding an individual json file per reruit which hold all their timeline event

However, there are some useful scripts included to format and clean the data in useful ways. The first of these is the `merge_utility.py` which simply contains methods to merge all files in each of the top level directories into unified lists. This can be easier to manage than handling the thousands of files generated by the application depending on use case.

CONTINUED